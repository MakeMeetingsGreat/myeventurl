

    <!-- Modal -->
<div class="modal fade" id="eventform" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <div class="col-md-4" style="float:right">
                    <button style="margin: 0px; min-width:100%; min-height:100%;" v-if="evalCopyButton()" onclick="EventForm.createEvent()">Create</button>
                    <button style="margin: 0px; min-width:100%; min-height:100%;" v-if="evalCreateButton()" onclick="EventForm.createEvent()">Create</button>
                    <button style="margin: 0px; min-width:100%; min-height:100%;" v-if="evalEditButton()" onclick="EventForm.setServerEvent()">Save</button>
                </div>

                <h4 class="modal-title">{{ModalTitle}}</h4>
                <div v-if="Error.SignIn.Show" class="alert alert-danger hidden-print" style="margin:3px">
                    {{Error.SignIn.Message}}
                </div>
                <div v-if="Error.Start.Show" class="alert alert-danger hidden-print" style="margin:3px">
                    {{Error.Start.Message}}
                </div>
                <div v-if="Error.End.Show" class="alert alert-danger hidden-print" style="margin:3px">
                    {{Error.End.Message}}
                </div>
                <div v-if="Error.TZ.Show" class="alert alert-danger hidden-print" style="margin:3px">
                    {{Error.TZ.Message}}
                </div>
                <div v-if="Error.Forms.Show" class="alert alert-danger hidden-print" style="margin:3px">
                    {{Error.Forms.Message}}
                </div>
                <div v-if="Error.Sway.Show" class="alert alert-danger hidden-print" style="margin:3px">
                    {{Error.Sway.Message}}
                </div>
            </div>
            <div class="modal-body" style="padding:20px">
                <div class="row" style="padding:3px">
                    <div class="col-md-2">Background</div>
                    <div class="col-md-5">
                        <select v-model="Style" style="padding:3px">
                            <option v-for="style in StyleList" :value="style">{{style}}</option>
                        </select>
                    </div>
                </div>
                <div class="row" style="padding:3px">
                    <div class="col-md-2">Organizer</div>
                    <div class="col-md-9"><input v-model="Organizer" style="min-width:100%" /></div>
                </div>
                <div class="row" style="padding:3px">
                    <div class="col-md-2">Subject</div>
                    <div class="col-md-9"><input v-model="Subject" style="min-width:100%" /></div>
                </div>
                <div class="row" style="padding:3px">
                    <div class="col-md-2">Location</div>
                    <div class="col-md-9"><input v-model="Location" style="min-width:100%" /></div>
                </div>
                <div class="row" style="padding:3px">
                    <div class="col-md-2">Start</div>
                    <div class="col-md-5"><input onchange="EventForm.setStartTime()" v-model="StartTime" id="starttime" /></div>
                </div>
                <div class="row" style="padding:3px">
                    <div class="col-md-2">End</div>
                    <div class="col-md-5"><input onchange="EventForm.setEndTime()" v-model="EndTime" id="endtime" /></div>
                </div>
                <div class="row" style="padding:3px">
                    <div class="col-md-2">TimeZone</div>
                    <div class="col-md-5">
                        <select v-model="TimeZone" id="timezone" style="padding:3px">
                            <option v-for="tz in TimeZoneList" :title="tz.offset" :value="tz.label">{{tz.label}}</option>
                        </select>
                    </div>
                </div>
                <div class="row" style="padding:3px">
                    <div class="col-md-2">Description</div>
                    <div class="col-md-9"><textarea v-model="Description" rows="4" style="max-width:100%; min-width:100%"></textarea></div>
                </div>
                <div class="row" style="padding:3px">
                    <div class="col-md-2">Forms URL</div>
                    <div class="col-md-9"><input v-model="Forms" style="min-width:100%" /></div>
                </div>
                <div class="row" style="padding:3px">
                    <div class="col-md-2">Sway URL</div>
                    <div class="col-md-9"><input v-model="Sway" style="min-width:100%" /></div>
                </div>
                <div class="row" style="padding:3px">
                    <div class="col-md-1"><input type="checkbox" v-model="NoReply" /></div>
                    <div class="col-md-2">Mask Email</div>
                    <div class="col-md-1"><input type="checkbox" v-model="Private" /></div>
                    <div class="col-md-2">Private Event</div>
                    <div class="col-md-1"><input type="checkbox" v-model="Icon" /></div>
                    <div class="col-md-2">Use Icon</div>
                    <div class="col-md-1"><input type="checkbox" v-model="Reminder" /></div>
                    <div class="col-md-2">Event Reminder</div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Modal -->

<script>
    var momentjsformat = "MM/DD/YYYY hh:mm A";


    $(function () {
        //EventForm.StartTime = "04/19/2019 03:00 pm";
        //EventForm.EndTime = "04/19/2019 03:00 pm";

        var startDateTextBox = $('#starttime');
        var endDateTextBox = $('#endtime');

        $.timepicker.datetimeRange(
            startDateTextBox,
            endDateTextBox,
            {
                minInterval: (1000 * 60 * 60), // 1hr
                dateFormat: 'mm/dd/yy',
                timeFormat: 'hh:mm tt',
                start: {}, // start picker options
                end: {} // end picker options					
            }
        );

        EventForm.Organizer = Account.UserName;
        EventForm.Email = Account.Email;
    });
</script>

<script>
    var EventForm = new Vue({
        el: "#eventform",
        data: {
            ModalTitle: "Create Event",
            ModalButton: "Create",
            TimeZoneList: [],
            StyleList: ["Blue", "Green", "Grey", "Orange", "Pink", "Yellow"],
            Style: "Grey",
            EventId: "",
            Organizer: "",
            Email: "",
            Subject: "",
            Location: "",
            StartTime: "",
            EndTime: "",
            TimeZone: moment.tz.guess(),
            Created: "",
            Description: "",
            Reminder: true,
            Forms: "",
            Sway: "",
            Views: "",
            Engaged: "",
            NoReply: false,
            Private: false,
            Icon: false,
            Error: {
                Start: { Show: false, Message: "Start is not a valid date." },
                End: { Show: false, Message: "End is not a valid date." },
                TZ: { Show: false, Message: "TimeZone is not valid." },
                Forms: { Show: false, Message: "The Forms URL is not valid." },
                Sway: { Show: false, Message: "The Sway URL is not valid." },
                SignIn: { Show: false, Message: "You Must Sign In." }
            }
        },
        computed: {
            TzOffset: function () {
                return $('#timezone').find("option:selected").prop("title")
            }
        },
        beforeCreate: function() {
            axios.get('https://www.addevent.com/api/v1/timezones')
                .then(function (response) {
                    EventForm.TimeZoneList = response.data.data;
                })
        },
        updated: function () {
            if (this.Error.Start.Show || this.Error.End.Show || this.Error.TZ.Show || this.Error.Forms.Show || this.Error.Sway.Show) this.runValidateForm();
        },
        methods: {
            createEvent: function () {
                if (this.runValidateForm()) {
                    var event = {
                        Start: this.StartTime,
                        End: this.EndTime,
                        Timezone: this.TimeZone,
                        Title: this.Subject,
                        Description: this.Description,
                        Location: this.Location,
                        Organizer: this.Organizer,
                        Email: Account.Email,
                        Reminder: this.Reminder ? 15 : 0,
                        Format: "MM/DD/YYYY",
                        sway: this.Sway,
                        NoReply: this.NoReply,
                        Forms: this.Forms,
                        Created: Date.now,
                        Style: this.Style,
                        Private: this.Private,
                        Icon: this.Icon,
                        Views: 0,
                        Engaged: 0,
                        //To be removed from schema
                        search: null,
                        Facebook: null,
                        AllDay: null,
                        Recurring: null,
                        SocialCommentsEngine: null,
                        TwitterDataWidget: null,
                        YammerNetwork: null,
                        SummaryEngine: null,
                        youtube: null,
                        storify: null,
                        surveymonkey: null
                };

                    axios.post('/api/EventAPI', event)
                        .then(function (success) {
                            window.location.reload();
                        })
                        .catch(function (error) { console.log(error) });
                };
            },
            getServerEvent: function (id,modaltitle,modalbutton) {
                axios.get('/odata/GetEvent('+id+')')
                    .then(function (success) {
                        EventForm.ModalTitle = modaltitle;
                        EventForm.ModalButton = modalbutton;
                        EventForm.StartTime = moment(success.data.Start).format(momentjsformat);
                        EventForm.EndTime = moment(success.data.End).format(momentjsformat);
                        EventForm.Style = success.data.Style;
                        EventForm.Organizer = success.data.Organizer;
                        EventForm.Subject = success.data.Title;
                        EventForm.Description = success.data.Description;
                        EventForm.Location = success.data.Location;
                        EventForm.Email = success.data.Email;
                        EventForm.Reminder = (success.data.Reminder > 0) ? true : false;
                        EventForm.Format = success.data.Format;
                        EventForm.Sway = success.data.sway;
                        EventForm.NoReply = success.data.NoReply;
                        EventForm.Forms = success.data.Forms;
                        EventForm.Created = success.data.Created;
                        EventForm.Style = success.data.Style;
                        EventForm.Private = success.data.Private;
                        EventForm.Icon = success.data.Icon;
                        EventForm.Views = success.data.Views;
                        EventForm.Engaged = success.data.Engaged;
                        EventForm.EventId = id;
                    })
            },
            evalCopyButton: function () {
                return (this.ModalTitle == "Copy Event")
            },
            evalCreateButton: function () {
                return (this.ModalTitle == "Create Event")
            },
            evalEditButton: function () {
                return (this.ModalTitle == "Edit Event")
            },
            runCopyEvent: function (id) {
                this.getServerEvent(id, "Copy Event", "Create");
                $("#eventform").modal('show');
            },
            runEditEvent: function (id) {
                this.getServerEvent(id, "Edit Event", "Save");
                $("#eventform").modal('show');
            },
            runValidateForm: function () {
                this.Error.Start.Show = !(moment(this.StartTime, momentjsformat).isValid());
                this.Error.End.Show = !(moment(this.EndTime, momentjsformat).isValid());
                this.Error.TZ.Show = (_.findWhere(EventForm.TimeZoneList, { label: EventForm.TimeZone }) == null);
                this.Error.Forms.Show = !((/https:\/\/forms\.office\.com\/Pages\/ResponsePage\.aspx\?id/.test(this.Forms)) || this.Forms == "");                
                this.Error.Sway.Show = !((/https:\/\/sway\.office\.com\//.test(this.Sway)) || this.Sway == "");
                this.Error.SignIn.Show = (Account.Email == "");
                if (this.Error.Start.Show || this.Error.End.Show || this.Error.TZ.Show || this.Error.Forms.Show || this.Error.Sway.Show || this.Error.SignIn.Show) return false;
                return true;
            },
            setStartTime: function () {
                this.StartTime = $("#starttime").val();
            },
            setEndTime: function () {
                this.EndTime = $("#endtime").val();
            },
            setModalTitle: function (title) {
                this.ModalTitle = title;
            },
            setServerEvent: function () {
                if (this.runValidateForm()) {
                    var event = {
                        EventId: this.EventId,
                        Start: this.StartTime,
                        End: this.EndTime,
                        Timezone: this.TimeZone,
                        Title: this.Subject,
                        Description: this.Description,
                        Location: this.Location,
                        Organizer: this.Organizer,
                        Email: Account.Email,
                        Reminder: this.Reminder ? 15 : 0,
                        Format: "MM/DD/YYYY",
                        sway: this.Sway,
                        NoReply: this.NoReply,
                        Forms: this.Forms,
                        Created: Date.now,
                        Style: this.Style,
                        Private: this.Private,
                        Icon: this.Icon,
                        Views: this.Views,
                        Engaged: this.Engaged,
                        //To be removed from schema
                        search: null,
                        Facebook: null,
                        AllDay: null,
                        Recurring: null,
                        SocialCommentsEngine: null,
                        TwitterDataWidget: null,
                        YammerNetwork: null,
                        SummaryEngine: null,
                        youtube: null,
                        storify: null,
                        surveymonkey: null
                    };

                    axios.put('/api/EventAPI/'+event.EventId, event)
                        .then(function (success) {
                            window.location.reload();
                        })
                        .catch(function (error) { console.log(error) });
                };
            }


        }
    })
</script>
