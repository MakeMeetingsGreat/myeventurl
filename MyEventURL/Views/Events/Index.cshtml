@Html.Partial("_GridComponent")

@{
    ViewBag.Title = "Index";
}

<h2>Index</h2>

<p>
    @Html.ActionLink("Create New", "Create")
</p>

<div id="eventlist">
    <h3>Future Events:</h3>
    <grid :data="future"
          :columns="cols"
          :filter-key="searchQuery"
          edit="<a href='http://www.msn.com/{replace}'>Edit</a>"
          view="<a href='http://www.msn.com/{replace}'>View</a>"
          delete="<a href='http://www.msn.com/{replace}'>Delete</a>"
          add="<a href='http://www.msn.com/{replace}'>Add</a>"
          width="100%">
    </grid>
    <h3>Past Events:</h3>
    <grid :data="past"
          :columns="cols"
          :filter-key="searchQuery"
          width="100%">
    </grid>
</div>

<script>
    var EventList = new Vue({
        el: '#eventlist',
        data: {
            cols: [{ name:"Start", hide:false },
                   { name:"Title", hide:false },
                   { name:"Views", hide:true },
                   { name:"Adds", hide:true },
                   { name:"Actions", hide:false }],
            future: [],
            past: [],
            searchQuery: ''
        },
        beforeCreate: function () {
            axios.get('/odata/GetEvent?$orderby=Start desc')
                .then(function (response) {
                    response.data.value.forEach(function (fact) {
                        var startmoment = moment(fact.Start);
                        var event = {
                            Start: startmoment.format("MMM D"),
                            Title: fact.Title,
                            Views: fact.Views,
                            Adds: fact.Engaged,
                            Actions: fact.EventId
                        }
                        var nowmoment = moment(Date.now());
                        if (nowmoment.diff(startmoment) < 0) EventList.future.push(event); else EventList.past.push(event)
                    })
                })
        }
    })
</script>